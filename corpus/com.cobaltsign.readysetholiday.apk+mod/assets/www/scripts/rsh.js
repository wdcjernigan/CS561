document.addEventListener("deviceready",onDeviceReady,false);function onDeviceReady(){initSQL();getDevicePlatform();getDeviceOSVersion();refreshTemperature();setWeatherDegree();setLocationHomePage();showHideHelp();setLocation();setDate();setRemainingTime();setCheckedForTemperatureDegree();document.getElementById("linkEmail").href=getMailToLink();onlyAndroid();}function refreshTemperature(){checkDataConnection();getTemperatureForLocation(localStorage.location);}function dataShow(){setRemainingTime();getTemperatureForLocation(localStorage.location);}function setWeatherDegree(){if(localStorage.temperature==null||localStorage.temperature==""){localStorage.temperature="C";}var lblTempDegree=document.getElementById("lblTemperatureDegree");lblTempDegree.innerHTML=localStorage.temperature;}function setRemainingTime(){var dateString=localStorage.date;if(dateString!=null&&dateString!=""){var currentDate=new Date();currentDate.setHours(0,0,0,0);var ar=dateString.split("-");var holidayDate=new Date(ar[0],ar[1]-1,ar[2]);var interval=(holidayDate.getTime()-currentDate.getTime());if(interval<0){interval=0;}var msecPerMinute=1000*60;var msecPerHour=msecPerMinute*60;var msecPerDay=msecPerHour*24;var days=Math.floor(interval/msecPerDay);var weeks=Math.floor(days/7);days=days-(weeks*7);var lblWeeks=document.getElementById("remainingWeeks");lblWeeks.innerHTML=weeks;var lblDays=document.getElementById("remainingDays");lblDays.innerHTML=days;AdjustPlurals(weeks,days);}}function AdjustPlurals(weeks,days){if(weeks==1){document.getElementById("labelWeeks").innerHTML="week";}else{document.getElementById("labelWeeks").innerHTML="weeks";}if(days==1){document.getElementById("labelDays").innerHTML="day";}else{document.getElementById("labelDays").innerHTML="days";}}function showHideHelp(){var divHelpIOS=document.getElementById("help-box-ios");var divHelpAndroid=document.getElementById("help-box-android");if(localStorage.location==null||localStorage.location==""){if(devicePlatform=="Android"){divHelpAndroid.style.display="block";}else{divHelpIOS.style.display="block";}}else{divHelpAndroid.style.display="none";divHelpIOS.style.display="none";}}function setLocationHomePage(){if(localStorage.location==null){localStorage.location="";}var divLoc=document.getElementById("location-name");divLoc.innerHTML=localStorage.location;}function setLocation(){if(localStorage.location==null){localStorage.location="";}var lblLoc=document.getElementById("hLocation");lblLoc.value=localStorage.location;}function setCheckedForTemperatureDegree(){var tempDeg=localStorage.temperature;if(tempDeg=="F"){document.getElementById("chkFahrenheit").checked="checked";}else{document.getElementById("chkCelsius").checked="checked";}}function setDate(){var lblLoc=document.getElementById("hDate");if(devicePlatform=="Android"){if(localStorage.getItem("date")===null){var newDate=new Date();var year=newDate.getFullYear();var month=zeroMaker(newDate.getMonth()+1);var day=zeroMaker(newDate.getDate());lblLoc.value=year+"-"+month+"-"+day;localStorage.date=lblLoc.value;}else{lblLoc.value=localStorage.date;}}else{lblLoc.value=localStorage.date;}}function getTemperatureForLocation(desiredLocation){if(desiredLocation!=""&&desiredLocation!=null){var weatherService="http://api.worldweatheronline.com/free/v1/weather.ashx?q="+desiredLocation+"&format=xml&key=tbhsc3htj2d6y7gztv8dsvz7";if(deviceHasDataConnection==1){document.getElementById("error-box").style.display="none";$.ajax({type:"GET",url:weatherService,dataType:"xml",success:getTemperature});}else{document.getElementById("error-box").style.display="block";lblError.innerHTML="no internet connection";}}else{document.getElementById("lblTemperatureValue").innerHTML="?";}}function getTemperature(data){var lblTempDegree=document.getElementById("lblTemperatureValue");var temp="?";if(localStorage.temperature=="C"){temp=$(data).find("temp_C").text();}else{temp=$(data).find("temp_F").text();}if(temp==null){temp="?";document.getElementById("error-box").style.display="block";lblError.innerHTML="no data available";}lblTempDegree.innerHTML=temp;}function getOtherAppsService(){var otherAppsService="http://apps.cobaltsign.com/api/cross/1";if(deviceHasDataConnection==1){$.ajax({type:"GET",url:otherAppsService,dataType:"xml",success:getOtherAppsServiceCallBack});}else{}}function getOtherAppsServiceCallBack(data){$(data).find("FeaturedApp").each(function(){alert($(this).find("Description").text());});}function bindSwipeEvents(e){alert("bind");e.view.element.find("#swipeListView li li").kendoMobileSwipe(function(e){alert("swipe");if(e.direction=="right"){e.target.addClass("strike");}else{e.target.removeClass("strike");}});}function bindSwipes(){alert("bind");$("li.swipeOneItem").kendoMobileSwipe(function(e){alert("swipe");if(e.direction=="right"){e.target.addClass("strike");}else{e.target.removeClass("strike");}});}function keyPressed(e){if(e.keyCode==13||e.which==13){addTask();}}function getMailToLink(){var mailToLink="mailto:ready.set.holiday@cobaltsign.com?subject=Feedback%20from%20"+devicePlatform+"%20"+deviceOSVersion;return mailToLink;}function handleChange(cb,temperature){if(cb.checked==1){if(temperature=="C"){localStorage.temperature="C";}else{localStorage.temperature="F";}setWeatherDegree();getTemperatureForLocation(localStorage.location);}}function saveLocation(inp){localStorage.location=inp.value;setLocationHomePage();getTemperatureForLocation(inp.value);showHideHelp();}function saveDate(inp){if(inp.value!=""){localStorage.date=inp.value;setRemainingTime();}}var devicePlatform="";var deviceOSVersion="";var deviceHasDataConnection=0;function getDevicePlatform(){devicePlatform=device.platform;}function getDeviceOSVersion(){deviceOSVersion=device.version;}function checkDataConnection(){var networkState=navigator.network.connection.type;if(networkState==Connection.NONE||networkState==Connection.UNKNOWN){deviceHasDataConnection=0;}else{deviceHasDataConnection=1;}}function onlyAndroid(){if(devicePlatform=="Android"){initDatePicker();var androidVersionNumber=deviceOSVersion.substring(0,1);if(androidVersionNumber!="4"){document.getElementById("holiday-box").className="android23-box";}}}function initDatePicker(){$(".nativedatepicker").unbind("click");$(".nativedatepicker").click(function(event){var currentField=$(this);var myNewDate=new Date(Date.parse(currentField.val()))||new Date();window.plugins.datePicker.show({date:myNewDate,mode:"date",allowOldDates:true},function(returnDate){var newDate=new Date(returnDate);var year=newDate.getFullYear();var month=zeroMaker(newDate.getMonth()+1);var day=zeroMaker(newDate.getDate());currentField.val(year+"-"+month+"-"+day);currentField.blur();});});}function zeroMaker(number){if(number<10){return"0"+number;}else{return""+number;}}var toDoList={};toDoList.webdb={};toDoList.webdb.db=null;toDoList.webdb.open=function(){var dbSize=5*1024*1024;toDoList.webdb.db=openDatabase("Todo","1.0","Todo manager",dbSize);};toDoList.webdb.createTable=function(){if(localStorage.webDbExists!=null){return;}else{localStorage.webDbExists=1;}var db=toDoList.webdb.db;db.transaction(function(tx){tx.executeSql("CREATE TABLE IF NOT EXISTS todo(ID INTEGER PRIMARY KEY ASC, todo TEXT, added_on DATETIME, isDone BOOL)",[]);var nume=tx.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name='todo'");if(nume!="todo"){var addedOn=new Date();tx.executeSql("INSERT INTO todo(todo, added_on, isDone) VALUES ('reserve plane tickets',?,0)",[addedOn],toDoList.webdb.onSuccess,toDoList.webdb.onError);tx.executeSql("INSERT INTO todo(todo, added_on, isDone) VALUES ('buy bigger luggage',?,0)",[addedOn],toDoList.webdb.onSuccess,toDoList.webdb.onError);tx.executeSql("INSERT INTO todo(todo, added_on, isDone) VALUES ('check passport validity',?,0)",[addedOn],toDoList.webdb.onSuccess,toDoList.webdb.onError);tx.executeSql("INSERT INTO todo(todo, added_on, isDone) VALUES ('take the keys',?,0)",[addedOn],toDoList.webdb.onSuccess,toDoList.webdb.onError);tx.executeSql("INSERT INTO todo(todo, added_on, isDone) VALUES ('search travel guide app',?,0)",[addedOn],toDoList.webdb.onSuccess,toDoList.webdb.onError);}});};toDoList.webdb.addTodo=function(todoText){var db=toDoList.webdb.db;db.transaction(function(tx){var addedOn=new Date();tx.executeSql("INSERT INTO todo(todo, added_on, isDone) VALUES (?,?,0)",[todoText,addedOn],toDoList.webdb.onSuccess,toDoList.webdb.onError);});};toDoList.webdb.onError=function(tx,e){};toDoList.webdb.onSuccess=function(tx,r){toDoList.webdb.getAllTodoItems(loadTodoItems);};toDoList.webdb.getAllTodoItems=function(renderFunc){var db=toDoList.webdb.db;db.transaction(function(tx){tx.executeSql("SELECT * FROM todo order by added_on desc",[],renderFunc,toDoList.webdb.onError);});};toDoList.webdb.deleteTodo=function(id){var db=toDoList.webdb.db;db.transaction(function(tx){tx.executeSql("DELETE FROM todo WHERE ID=?",[id],toDoList.webdb.onSuccess,toDoList.webdb.onError);});};function loadTodoItems(tx,rs){var rowOutput="";var todoItems=document.getElementById("taskList");for(var i=0;i<rs.rows.length;i++){rowOutput+=renderTodo(rs.rows.item(i));}todoItems.innerHTML=rowOutput;}function renderTodo(row){if(row.isDone==0){return"<li class='swipeOneItem'>"+row.todo+"<a data-role='detailbutton' data-icon='trash' class='km-detail' onclick='toDoList.webdb.deleteTodo("+row.ID+");'><span class='km-icon km-trash'></span></a></li>";}else{return"<li class='swipeOneItem strike'>"+row.todo+"<a data-role='detailbutton' data-icon='trash' class='km-detail' onclick='toDoList.webdb.deleteTodo("+row.ID+");'><span class='km-icon km-trash'></a></li>";}}function initSQL(){toDoList.webdb.open();toDoList.webdb.createTable();toDoList.webdb.getAllTodoItems(loadTodoItems);}function addTask(){var task=document.getElementById("txtNewTask");if(task.value!=""){toDoList.webdb.addTodo(task.value);}task.value="";}function modifyTask(row){if(row.todo==1){row.todo=0;}else{row.todo=1;}}function swipeTask(index){var todoItems=document.getElementById("taskList");if(index<=rs.rows.length){modifyTask(rs.rows.item(i));}}